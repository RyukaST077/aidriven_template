# 外部インターフェース設計書

## 1. インターフェース一覧
| IF ID | 連携システム | 名称 | 方式 | プロトコル | 方向 | 頻度 | 備考 |
| -- | -- | -- | -- | -- | -- | -- | -- |
| IF001 | 決済代行システム | 決済API | REST API | HTTPS | Out | 都度 | |
| IF002 | 基幹システム | 売上データ連携 | ファイル転送 | SFTP | Out | 日次 | |

## 2. インターフェース詳細

### 2.0 OpenAPI仕様 (Swagger)
<!-- 本設計書はOpenAPI (v3.x) 形式での定義を正とします。詳細は以下のYAML/JSONを参照してください。 -->
* **Define File**: [`docs/openapi.yaml`](../openapi.yaml)
* **Viewer**: Swagger UI / Redoc

### 2.1 [IF001] 決済API
#### 2.1.1 概要
ユーザーが商品を注文した際に、即時決済を行うためのAPI。

#### 2.1.2 接続情報
* **Base URL**: `https://api.payment-gateway.com`
* **Auth**: Bearer Token (OAuth 2.0)

#### 2.1.3 インターフェース定義 (OpenAPI Structure)
**Operation**: `POST /v1/charges`
**Summary**: Create a charge

**Parameters / Request Body**:
| Name | In | Type | Required | Description |
| -- | -- | -- | -- | -- |
| Authorization | header | string | Yes | Bearer Token |
| amount | body | integer | Yes | 決済金額 |
| currency | body | string | Yes | 通貨コード (jpy) |
| source | body | string | Yes | トークンID |

**Responses**:
| Code | Description | Content-Type | Schema Ref |
| -- | -- | -- | -- |
| 200 | 決済成功 | application/json | `#/components/schemas/Charge` |
| 400 | バリデーションエラー | application/json | `#/components/schemas/Error` |
| 401 | 認証失敗 | application/json | `#/components/schemas/Error` |

**(Example Response 200)**
```json
{
  "id": "ch_123456",
  "amount": 1000,
  "status": "succeeded"
}
```

---
### 2.2 [IF002] 売上データ連携
#### 2.2.1 概要
前日分の売上データをCSVファイルとして基幹システムへ送信する。

#### 2.2.2 ファイル仕様
* ファイル名: `sales_YYYYMMDD.csv`
* 文字コード: UTF-8 (BOMなし)
* 改行コード: LF
* 区切り文字: カンマ (`,`)

#### 2.2.3 レイアウト
| No | 項目名 | 型 | 桁数 | 必須 | 備考 |
| -- | -- | -- | -- | -- | -- |
| 1 | 売上日 | Date | 8 | 〇 | YYYYMMDD |
| 2 | 店舗コード | String | 10 | 〇 | |
| 3 | 売上金額 | Number | 10 | 〇 | |

#### 2.2.4 通信仕様
* プロトコル: SFTP
* 認証: 公開鍵認証
* 転送タイミング: 毎日 AM 4:00
