# 運用設計書 / 運用手順書

## 1. 運用方針 (SRE Principles)
### 1.1 運用のミッション
システムの信頼性を維持しつつ、機能リリースの速度を最大化する。
**Reliability** を最も重要な機能と捉え、ソフトウェアエンジニアリングの手法を用いて運用課題を解決する。

### 1.2 SLO / Error Budget
* **SLI (Service Level Indicator)**: 成功したHTTPリクエストの割合
* **SLO (Service Level Objective)**: 月間稼働率 99.9%
* **Error Budget**: 残りの許容ダウンタイム時間を可視化し、予算枯渇時は機能リリースを凍結して信頼性向上に注力する。

### 1.3 トイル (Toil) の削減
手作業で行っている定型業務（トイル）を特定し、自動化によって削減する。
* 目標: 運用業務の50%以下をトイルとし、残りをエンジニアリングに充てる。

## 2. 監視設計 (Observability)
### 2.1 3つの柱 (Logs, Metrics, Traces)
* **Metrics**: CPU, Memory, Request Rate, Error Rate, Latency (Prometheus/Datadog)
* **Logs**: アプリケーションログ、アクセスログ (JSON形式, CloudWatch Logs/Fluentd)
* **Traces**: マイクロサービス間の分散トレーシング (OpenTelemetry, Jaeger/X-Ray)

### 2.2 監視項目一覧
| 監視ID | 対象 | 項目 | 閾値 | 通知レベル | アクション |
| -- | -- | -- | -- | -- | -- |
| M01 | Web Server | CPU使用率 | > 80% (5分継続) | Warning | オートスケールを見守る |
| M02 | Web Server | 生存確認(Health Check) | ステータスコード != 200 | Critical | 自動再起動 / 担当者へ架電 |
| M03 | DB | ディスク空き容量 | < 20% | Warning | 容量拡張を検討 |

## 3. 定常作業 (Routine Work)
### 3.1 日次作業
* ログ確認: エラーログの有無をチェック（Dashboard閲覧）
* バックアップ確認: 夜間バックアップの成功通知を確認

### 3.2 月次作業
* パッチ適用: OS/ミドルウェアのセキュリティパッチ適用（メンテナンス枠で実施）
* レポート作成: 稼働率、エラーバジェット消費状況のレポート作成

## 4. 障害対応 (Incident Management)
### 4.1 対応フロー
1. **検知**: アラート受信またはユーザー申告。
2. **一次切り分け**: インフラ起因かアプリ起因か特定。ステータスページ更新。
3. **暫定対応**: 再起動、設定変更などによるサービス復旧。
4. **恒久対応**: 原因調査と根本改修（後日リリース）。
5. **事後分析 (Blameless Postmortem)**: 「なぜ」起きたかを深掘りし、個人を責めずにプロセスの改善策を策定するレポートを作成。

### 4.2 障害レベル定義
| レベル | 定義 | 連絡範囲 | 目標復旧時間 |
| -- | -- | -- | -- |
| Sev-1 (Critical) | 全サービス停止、データ消失の危機 | 経営層含む全員 | 1時間以内 |
| Sev-2 (Major) | 一部機能停止、業務に支障あり | 開発・運用チーム | 4時間以内 |
| Sev-3 (Minor) | 表示崩れ、軽微なバグ | 担当者のみ | 翌営業日以降 |

## 5. バックアップ・リストア運用の詳細
（具体的なリストアコマンド手順などを記述）
