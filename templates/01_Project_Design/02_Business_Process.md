# 業務フロー／業務ルール定義（To-Be）

> システム開発における「業務のやり方（To-Be）」と「例外」「権限に関わるルール」を、要求定義～設計・テストへ一貫して落とし込むためのテンプレート。
>
> **本書の位置づけ**：要求定義／要件定義を補完し、基本設計（画面・帳票・I/F・データ・バッチ）とテスト計画／仕様に直結する“業務視点の仕様書”。

---

## 0. 文書管理

* 文書名：
* 対象システム／プロジェクト：
* 作成者：
* レビュー者：
* 承認者：
* 版数／改訂履歴：

  * v0.1（作成日）：
* 参照資料：

  * 要求定義／要件定義書：
  * 機能一覧・画面／帳票一覧：
  * 方式設計（権限方針／ログ方針／監査等）：

---

## 1. 目的・スコープ

### 1.1 目的

* 本書で定義すること：

  * To-Beの業務フロー（標準・例外・分岐）
  * 業務ルール（判断基準、計算、状態遷移、締め、承認、権限）
  * ルールを支えるデータ、画面操作、外部連携、バッチの前提
* 本書で定義しないこと（他ドキュメントへ委譲）：

  * 画面レイアウト詳細 → 画面設計書
  * API/IF詳細 → 外部IF設計書
  * テーブル物理定義 → データ設計書

### 1.2 対象業務範囲

* 対象業務領域（例：受注、出荷、請求、精算 等）：
* 対象組織／拠点：
* 対象ユーザー種別：
* 対象チャネル（Web、モバイル、EDI等）：

### 1.3 前提・制約（業務起因）

* 営業日／締め日／カットオフ：
* 法令・規程・社内ルール：
* マスタの権威／更新責任：
* 既存運用との共存期間：

### 1.4 用語・略語

| 用語 | 定義 | 備考 |
| -- | -- | -- |
| BREQ | ビジネス要求ID |  |
| FR | 機能要件ID |  |
| NFR | 非機能要件ID |  |
| CON | 制約ID |  |
| AC | 受入条件ID |  |
| BP | 業務プロセスID |  |
| ACT | アクティビティID |  |
| BRL | 業務ルールID |  |
| EX | 業務例外ID |  |
| SC | データスコープID |  |
|    |    |    |

---

## 2. 全体像（サマリ）

### 2.1 業務ゴールとKPI（任意）

* ゴール：
* 指標（処理時間、ミス率、リードタイム等）：

### 2.2 To-Be業務プロセス一覧

| プロセスID | プロセス名 | 開始条件 | 終了条件 | 主要ロール | 関連機能（FR-ID） | 優先度 | 備考 |
| ------ | ----- | ---- | ---- | ----- | ---------- | --- | -- |
| BP-001 |       |      |      |       |            |     |    |

### 2.3 状態遷移（高レベル）

* 対象（例：申請、注文、案件、チケット等）：
* 状態一覧：
* 遷移の概要：

> 補足：詳細な状態遷移表は「5. 業務ルール（状態・承認・締め）」で定義。

---

## 3. 役割（ロール）・組織・権限モデル

> 権限は「画面操作可否」だけでなく、**データ範囲（スコープ）**・**実行可能な操作**・**承認権限**・**代行**・**職務分掌（SoD）**まで含めて定義する。

### 3.1 ロール定義

| ロールID | ロール名 | 主な業務責任 | 所属/想定組織 | 備考 |
| ----- | ---- | ------ | ------- | -- |
| ROLE-001 |      |        |         |    |

### 3.2 権限の粒度（方針）

* 権限判定単位：

  * 機能（メニュー／API）
  * 操作（参照／登録／更新／削除／承認／取消／出力／再処理等）
  * データ範囲（自部門のみ、担当顧客のみ、拠点、全社など）
* 認可方式：ロールベース／属性ベース（ABAC）／混在
* 代行・委任：有／無（有の場合、期間・記録・制約）

### 3.3 ロール×操作権限マトリクス（業務視点）

| 対象（業務オブジェクト） | 操作 | ROLE-001 | ROLE-002 | ROLE-003 | 判定条件（データ範囲等） | ログ/監査 |
| ------------ | -- | ----: | ----: | ----: | ------------ | ----- |
| 例：申請         | 起票 |     ○ |     — |     — | 自部門          | 操作ログ  |
| 例：申請         | 承認 |     — |     ○ |     — | 金額<=X        | 監査ログ  |

### 3.4 SoD（職務分掌）・禁止組合せ

| ルールID   | 禁止対象（ロール/操作） | 理由   | 回避策（例外運用）     | 監査 |
| ------- | ------------ | ---- | ------------- | -- |
| SOD-001 | 起票と最終承認の兼務禁止 | 不正防止 | 緊急時は上長承認＋監査記録 | 必須 |

### 3.5 権限のライフサイクル（付与・変更・剥奪）

* 申請／承認フロー：
* 反映タイミング：即時／日次
* 退職・異動時：
* 権限棚卸：頻度、責任者

---

## 4. 業務フロー定義（To-Be）

> ここでは**業務プロセスごと**に「標準フロー」「例外フロー」「入力・出力」「関係者」「システム境界」を定義する。

### 4.1 記法・表現ルール

* フロー記法：BPMN／スイムレーン／UMLアクティビティ 等（本プロジェクトの標準： ）
* ID規約：

  * 業務プロセス：BP-xxx
  * アクティビティ：ACT-xxx
  * ルール：BRL-xxx
  * 例外：EX-xxx
  * イベント（開始/終了/タイマー）：EV-xxx

### 4.2 業務プロセス詳細（テンプレ）

#### BP-xxx：＜プロセス名＞

* 目的：
* 関連する業務オブジェクト：
* 開始条件（トリガー）：
* 終了条件（成果物/状態）：
* 主要ロール（スイムレーン）：
* 関連機能（機能一覧のID）：
* 関連画面／帳票：
* 関連I/F／外部システム：
* 処理頻度：
* SLA/リードタイム目標（任意）：

##### 4.2.1 標準フロー（ハッピーパス）

| No | アクティビティ（誰が） | 入力 | 処理内容 | 出力 | 関連ルール（BRL-ID） | 関連画面/IF | ログ/監査 |
| -: | ----------- | -- | ---- | -- | ------------ | ------- | ----- |
|  1 |             |    |      |    |              |         |       |

##### 4.2.2 例外・分岐フロー

| EX-ID  | 発生条件（トリガー） | 分岐点（No/ACT-ID） | 対応（手戻り/代替/中断） | 通知/エスカレーション | 関連ルール（BRL-ID） | 運用回避策 |
| ------ | ---------- | -------------- | ------------- | ----------- | ------------ | ----- |
| EX-001 |            |                |               |             |              |       |

##### 4.2.3 システム境界・責任分界

| 区分    | 担当    | 具体例             |
| ----- | ----- | --------------- |
| 人（業務） | 利用者   | 入力、判断、承認        |
| システム  | アプリ   | 自動判定、計算、ステータス更新 |
| 外部    | 他システム | マスタ提供、決済、配送等    |

##### 4.2.4 通知・コミュニケーション

* 通知チャネル：メール／アプリ通知／Slack等
* 通知タイミング：
* テンプレートID（任意）：
* 既読/未読、再通知、期限超過：

##### 4.2.5 記録・エビデンス

* 監査上必要な記録：誰が・いつ・何を・なぜ
* 添付ファイルの扱い：保存期間、改ざん防止

---

## 5. 業務ルール定義（Business Rules）

> ルールは「文章」だけでなく、**表形式**で**条件・判定・結果・例外**を明確化する。実装やテストに直結する粒度で。

### 5.1 ルール分類

* BRL-A：業務判断（条件分岐、可否判定）
* BRL-C：計算（料金、金額、在庫引当、ポイント等）
* BRL-S：状態遷移（ステータス、承認段階）
* BRL-T：締め・カットオフ（営業日、月次、期日）
* BRL-R：権限・スコープ（参照範囲、操作可否、代行）
* BRL-E：例外・エラー（業務例外、復旧手順）

### 5.2 ルール一覧

| BRL-ID  | 名称 | 分類   | 適用範囲（BP/画面/IF） | 概要 |  優先度 | 関連要件ID（BREQ/FR）  | 備考 |
| ------ | -- | ---- | -------------- | -- | ---: | ------- | -- |
| BRL-001 |    | BRL-A | BP-001         |    | High | BREQ-xxx / FR-xxx |    |

### 5.3 ルール詳細テンプレ（共通）

#### BRL-xxx：＜ルール名＞

* 分類：BRL-A/C/S/T/R/E
* 目的：
* 適用範囲：プロセス、画面、帳票、API、バッチ
* 対象データ（主キー、識別子）：
* 入力（参照する属性）：
* 出力（更新する属性／通知／結果）：
* 前提条件：
* ルール本文（簡潔に）：
* 優先順位（競合時の勝ち）：
* 例外・除外条件：
* 関連する例外（EX-ID）：
* 関連テスト観点（任意）：

##### 5.3.1 決定表（Decision Table）

| 条件                 | C1 | C2 | C3 | … |
| ------------------ | -- | -- | -- | - |
| 条件1：               | Y  | Y  | N  |   |
| 条件2：               | N  | Y  | N  |   |
| **結果：操作可否/遷移/計算式** | R1 | R2 | R3 |   |
| エラーコード/メッセージ       |    |    |    |   |
| 通知                 |    |    |    |   |

##### 5.3.2 擬似コード／計算式（必要な場合）

* 式：
* 端数処理：切捨て／切上げ／四捨五入（桁： ）
* 税区分：内税／外税、税率の決定ロジック

##### 5.3.3 データ更新（CRUD）

| 対象テーブル/概念 | 操作 | 更新項目 | 更新条件 | 同時実行・排他 | 監査項目 |
| --------- | -- | ---- | ---- | ------- | ---- |

---

## 6. 例外・エラー・リカバリ（業務例外）

> システムエラーではなく、**業務上の例外（不足、期限超過、差戻し、取消、重複、不整合）**を明確化する。

### 6.1 例外カタログ

| EX-ID  | 名称 | 発生ポイント（BP/ACT） | 検知方法   | 利用者への提示 | システム対応 | 運用対応   | 再発防止  |
| ------ | -- | -------------- | ------ | ------- | ------ | ------ | ----- |
| EX-001 |    | BP-001/No2     | 入力チェック | ダイアログ   | 保存中断   | 担当者へ連絡 | マスタ整備 |

### 6.2 取消・差戻し・再処理ルール

| 対象   | 操作  | 可能条件 | 不可条件  | 影響範囲（データ/外部） | 監査 | 通知   |
| ---- | --- | ---- | ----- | ------------ | -- | ---- |
| 例：申請 | 差戻し | 承認前  | 最終承認後 | 履歴保持         | 必須 | 起票者へ |

### 6.3 期限超過・タイムアウト・自動処理

* 期限超過時の扱い：自動キャンセル／継続／エスカレーション
* タイマーイベント（例：T+3営業日）：
* 自動バッチの責任分界：

---

## 7. 承認・ワークフロー（任意）

### 7.1 承認パターン

* 直列／並列／条件分岐（額・リスク・拠点）
* 代理承認／不在時の扱い

### 7.2 承認ステップ定義

| Step | 承認者ロール | 条件 | 承認アクション | 差戻し先 | 承認期限 | 証跡（必須項目） |
| ---: | ------ | -- | ------- | ---- | ---- | -------- |
|    1 |        |    | 承認/否認   | 起票者  | 3営業日 | 理由、日時    |

### 7.3 状態遷移表（詳細）

| 現状態 | イベント/操作 | 遷移先 | 許可ロール | 条件（BRL-ID） | 副作用（通知/IF/更新） |
| --- | ------- | --- | ----- | --------- | ------------- |
| 下書き | 提出      | 申請中 | ROLE-001 | BRL-0xx    | 通知A、履歴        |

---

## 8. データスコープ・参照範囲ルール（権限の具体化）

> 「誰がどのデータを見られる/触れるか」を、検索条件・一覧表示・出力・APIまで含めて定義する。

### 8.1 データスコープ定義

| スコープID | 説明    | キー属性（例：部門ID、拠点ID、担当者ID） | 適用対象（画面/API/帳票） |
| ------ | ----- | ----------------------- | --------------- |
| SC-001 | 自部門のみ | dept_id                 | 一覧/出力           |

### 8.2 スコープ判定ルール

* 判定順序：
* 例外（監査ロール、管理者ロール等）：

### 8.3 出力・エクスポート制御

| 帳票/CSV | 出力可能ロール | マスキング要否 | マスキング規則 | 出力ログ | 保管期間 |
| ------ | ------- | ------- | ------- | ---- | ---- |

---

## 9. 外部連携・バッチと業務ルール

### 9.1 連携イベント一覧（業務視点）

| 連携ID   | 相手先 | タイミング（BP/状態） | 方向 | 目的 | 失敗時の業務影響 | リトライ/代替 |   |
| ------ | --- | ------------ | -- | -- | -------- | ------- | - |
| IF-001 |     | BP-001/承認後   | 送信 |    |          |         |   |

### 9.2 データ同期・整合性ルール

* マスタ優先順位（System of Record）：
* 二重登録／突合：
* 遅延・部分失敗時：

### 9.3 バッチ（締め・集計・自動更新）

| バッチID | 目的 | 起動条件 | 対象期間 | 入力 | 出力 | 例外時対応 | 監査 |
| ----- | -- | ---- | ---- | -- | -- | ----- | -- |

---

## 10. 監査・ログ・証跡（業務要件として）

> 方式設計のログ方針に整合させつつ、**業務として必要な証跡**を具体化。

### 10.1 監査要件

* 監査対象操作：
* 監査項目：操作者、日時、対象ID、変更前後、理由、承認経路
* 参照ログ（閲覧ログ）要否：

### 10.2 証跡の保存・検索

* 保存期間：
* 検索条件（監査者が追えること）：
* 改ざん防止（WORM等）要否：

---

## 11. ルールの優先順位・競合・例外許可

### 11.1 優先順位（ルール階層）

例：

1. 法令・契約
2. 社内規程
3. 業務ルール（RULE）
4. システム都合の制約

### 11.2 競合パターンと解決

| パターン | 例 | 解決方針 | 最終判断者 |
| ---- | - | ---- | ----- |

### 11.3 例外許可（エクセプション）運用

* 許可者：
* 記録：
* 期限：
* 監査：

---

## 12. 要件・設計・テストへのトレーサビリティ

### 12.1 トレーサビリティ表

| BP/BRL/EX | ID     | 要件ID（BREQ） | 機能ID（FR） | 画面ID    | 帳票ID    | IF-ID  | データ項目ID | テストID  |
| -------- | ------ | --------- | ------- | ------- | ------- | ------ | ------- | ------ |
| BP       | BP-001 | BREQ-010   | FR-023   | SCR-005 | RPT-002 | IF-001 | D-123   | TC-001 |

### 12.2 変更影響分析（テンプレ）

* 変更内容：
* 影響するBP/RULE/EX：
* 影響する画面／帳票／IF／データ：
* 追加・更新が必要なテスト：

---

## 13. レビュー観点（チェックリスト）

### 13.1 完全性

* [ ] 全プロセスに開始/終了条件がある
* [ ] 標準フローと例外フローが区別されている
* [ ] 権限（操作×スコープ）が全主要操作に定義されている

### 13.2 一貫性

* [ ] 用語が要件定義・画面設計と一致
* [ ] 状態遷移が画面操作・IF・バッチと矛盾しない
* [ ] ルールIDがフローから参照されている

### 13.3 実装・テスト可能性

* [ ] ルールが決定表/式/擬似コードで判定可能
* [ ] 例外時のメッセージ・運用対応が定義されている
* [ ] 監査ログ要件が具体（項目・期間）

---

## 付録A：図のテンプレ（例）

* BPMN/スイムレーン図の貼り付け領域
* 状態遷移図の貼り付け領域

## 付録B：ID命名規約（例）

* BP-001：業務プロセス
* ACT-001：アクティビティ
* BRL-001：業務ルール
* EX-001：例外
* SC-001：データスコープ
* SOD-001：職務分掌

## 付録C：よくある落とし穴（運用上の注意）

* 例外運用が別紙・口頭になり、設計・テストに落ちない
* 権限が「画面の表示可否」止まりで、データ範囲が未定義
* 締め／カットオフが曖昧で、月次処理や再処理が破綻
* 取消・差戻しの影響（外部連携、帳票、監査）が未整理
